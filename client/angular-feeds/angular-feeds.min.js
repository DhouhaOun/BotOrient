/**
 * angular-feeds - v0.0.4 - 2017-03-14 8:09 AM
 * https://github.com/siddii/angular-feeds
 *
 * Copyright (c) 2017 
 * Licensed MIT <https://github.com/siddii/angular-feeds/blob/master/LICENSE.txt>
 */
"use strict";function feedDirective(a,b,c,d){function e(e,f,g,h,i){function j(a,c){if(e.feeds=[],f.html(b(a)(e)),c)for(var d=0;d<c.length;d++)e.feeds.push(c[d])}function k(a){g.postRender&&a&&h(function(){new Function("element",g.postRender+"(element);")(f)},0)}function l(b){a.getFeeds(b,g.count).then(function(a){g.template&&c.get(g.template)?j(c.get(g.template),a):g.templateUrl?d.get(g.templateUrl,{cache:c}).success(function(b){j(b,a)}):j(c.get("feed-list.html"),a)},function(a){console.error("Error loading feed ",a),e.error=a,j(c.get("feed-list.html"))})["finally"](function(){f.find(".spinner").slideUp(),e.$evalAsync("finishedLoading = true")})}function m(a){!isNaN(parseFloat(a))&&g.url&&n(a)}function n(a){o(),q=i(function(){l(g.url)},a)}function o(){q&&i.cancel(q)}e.$watch("finishedLoading",k),g.$observe("refreshAfter",m),g.$observe("url",l),e.feeds=[];var p=c.get("feed-spinner.html"),q=null;f.append(b(p)(e)),f.on("$destroy",o)}return{restrict:"E",scope:{summary:"=summary",refreshAfter:"="},controller:["$scope","$element","$attrs","$timeout","$interval",e]}}function feedService(a,b,c,d){function e(a){d.hasCache(a)&&d.unset(a)}function f(c,e){function f(a){try{YUI().use("yql",g(a))}catch(b){k.reject(b)}}function g(b){return function(c){var d="select * from feed(0,"+e+') where url = "'+b+'"',f=a.location&&a.location.href?a.location.href:null,g=f&&0===f.toLowerCase().indexOf("https")?"https":"http";c.YQL(d,i,{},{proto:g})}}function i(a){var b=[];if(a.query.count){var e="undefined"==typeof a.query.results.item?"entry":"item",f=a.query.results[e];d.set(c,f),b=h(f)}j(b)}function j(a){k.resolve(a)}var k=b.defer();return 0===e?(console.warn("called getFeeds with count "+e),setTimeout(k.resolve,400),k.promise):(d.hasCache(c)?k.resolve(h(d.get(c))):f(c),k.promise)}function g(a){var b={},d=[{indexName:"content",possibleIndexNames:["content","description","summary"]},{indexName:"title",possibleIndexNames:["title"]},{indexName:"link",possibleIndexNames:["link"]}];return d.forEach(function(d){d.possibleIndexNames.forEach(function(e){if(a[e]){var f="string"==typeof a[e]?a[e]:a[e].content;f||(f=a[e].href),b[d.indexName]=c.trustAsHtml(f)}})}),b}function h(a){for(var b=[],c=0;c<a.length;c++)b.push(g(a[c]));return b}return{getFeeds:f,clearCache:e}}function feedCache(){function a(){return"CACHE_TIMES"in localStorage?angular.fromJson(localStorage.getItem("CACHE_TIMES")):{}}function b(b){var d=a();return b in d&&b in localStorage&&(new Date).getTime()-d[b]<c}var c=3e5;return{set:function(b,c){localStorage.setItem(b,angular.toJson(c));var d=a();d[b]=(new Date).getTime(),localStorage.setItem("CACHE_TIMES",angular.toJson(d))},get:function(a){return b(a)?angular.fromJson(localStorage.getItem(a)):null},unset:function(a){localStorage.removeItem(a)},hasCache:b}}angular.module("feeds-directives",[]).directive("feed",["feedService","$compile","$templateCache","$http",feedDirective]),angular.module("feeds",["feeds-services","feeds-directives"]),angular.module("feeds-services",[]),angular.module("feeds-services").factory("feedService",["$window","$q","$sce","feedCache",feedService]),angular.module("feeds-services").factory("feedCache",feedCache),angular.module("feeds").run(["$templateCache",function(a){a.put("feed-list.html",'<div>\n    <div ng-show="error" class="alert alert-danger">\n        <h5 class="text-center">Oops... Something bad happened, please try later :(</h5>\n    </div>\n\n    <ul class="media-list">\n        <li ng-repeat="feed in feeds | orderBy:publishedDate:reverse" class="media">\n            <div class="media-body">\n                <h4 class="media-heading"><a target="_new" href="{{feed.link}}" ng-bind-html="feed.title"></a></h4>\n                <p ng-bind-html="!summary ? feed.content : feed.contentSnippet"></p>\n            </div>\n            <hr ng-if="!$last"/>\n        </li>\n    </ul>\n</div>'),a.put("feed-spinner.html",'<div class="spinner">\n    <div class="bar1"></div>\n    <div class="bar2"></div>\n    <div class="bar3"></div>\n    <div class="bar4"></div>\n    <div class="bar5"></div>\n    <div class="bar6"></div>\n    <div class="bar7"></div>\n    <div class="bar8"></div>\n</div>\n')}]);